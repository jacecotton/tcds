@use "mixins" as *;

/**
 * 1. Prevents text size from zooming in on mobile devices when orientation is
 *    switched from portrait to landscape.
 */
html {
  text-size-adjust: 100%; // 1
}

/**
 * 1. Disables oldstyle figures in Calluna. If Calluna is not used (nor any
 *    other font that uses oldstyle figures), can remove.
 * 2. Browsers in macOS still use subpixel antialiasing, but almost no other
 *    modern device does. We're not "fixing" font smoothing here, we're just
 *    aligning macOS browsers with the norm. We'll still keep it on for users
 *    with a high contrast preference set.
 */
body {
  color: var(--tcds-color-text);
  font-family: var(--tcds-font-copy);
  font-size: var(--tcds-font-size-m);
  font-variant-numeric: lining-nums; // 1
  font-variant-ligatures: none;
  overflow-wrap: break-word;

  @media (prefers-contrast: no-preference), (prefers-contrast: less) {
    -webkit-font-smoothing: antialiased; // 2
    -moz-osx-font-smoothing: grayscale; // 2
  }
}

:where(h1) {
  @include h1;
}

:where(h2) {
  @include h2;
}

:where(h3) {
  @include h3;
}

:where(h4) {
  @include h4;
}

:where(h5) {
  @include h5;
}

:where(h6) {
  @include h6;
}

:is(h1, h2, h3, h4, h5, h6) {
  :where(&:first-child:not(:only-child)) {
    margin: 0 0 1.5rem;
  }

  :where(&:not(:first-child)) {
    margin: 1.5rem 0;
  }
}

:where(:not(h1, hr) + h2),
:where(:not(h2, hr) + h3),
:where(:not(h3, hr) + h4) {
  margin-top: 3rem;
}

:where(
  small,
  sub,
  sup
) {
  font-size: max(var(--tcds-font-size-xs), 85%);
}

:where(sup) {
  vertical-align: baseline;
  position: relative;
  top: -.333lh;
}

a {
  :where(&) {
    color: var(--tcds-color-link);
    text-decoration: underline;
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgb(0 0 0 / 0%);
  }

  :where(&:hover) {
    text-decoration: none;
  }

  &[href]:not(:where(
    [is],
    [href^="#"],
    [href^="javascript:" i],
    [href^="/"]:not([href^="//"])
  )) {
    &::after {
      content: "";
      display: inline-block;
      background-color: var(--tcds-color-text);
      mask: var(--tcds-icon-utility-external) center no-repeat;
      opacity: .4;
      width: .66em;
      height: .66em;
      margin-left: .25em;
      vertical-align: middle;
    }
  }
}

/**
 * 1. We want to apply some default vertical margin to paragraph elements,
 *    unless the paragraph is either the first or last child in a container (as
 *    we still want them vertically flush). So we exclude those, but we also
 *    want to exclude any that are directly adjacent to [slot]ted elements,
 *    because those are never actually rendered.
 */
p {
  :where(&:not(:first-child, [slot] + *)) { // 1
    margin-top: 1.5em;
  }

  :where(&:not(:last-child)) {
    margin-bottom: 1.5em;
  }
}

:where(p, li) {
  line-height: var(--tcds-line-height, var(--tcds-line-height-m));
}

/**
 * 1. Safari removes role semantics from lists with `list-style: none`, but they
 *    can be readded with `[role=list]`. Therefore, as a general rule, never add
 *    `list-style: none` to list elements elsewhere in the codebase (components,
 *    etc.) Instead, add `role="list"` to any list from which you want `list-
 *    style` removed.
 */
ul,
ol {
  :where(&) {
    margin: 0 0 0 calc(1em + 3px);
    padding: 0;
  }

  :where(:not(li) > :is(&):not(:last-child)) {
    margin-bottom: 1rem;
  }

  &:where([role="list"]) {
    list-style: none; // 1
  }
}

ol {
  :where(& &) {
    list-style: upper-alpha;
  }

  :where(& & &) {
    list-style: upper-roman;
  }
}

/**
 * 1. List markers do not inherit `font-variant-numeric`, which is already
 *    declared in the `body` above.
 */
::marker {
  font-variant-numeric: lining-nums tabular-nums; // 1
}
