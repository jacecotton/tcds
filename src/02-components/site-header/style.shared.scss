:root {
  --tcds-site-header-height: 65px;
  --tcds-site-header-logo-width: 276px;

  @media (--above-s) {
    --tcds-site-header-height: 90px;
    --tcds-site-header-logo-width: 386px;
  }

  scroll-padding-top: calc(var(--tcds-site-header-height) + 1rem);
}

@mixin dark-header {
  --tcds-site-header-toggle-color: #fff;

  @media (min-width: 1280px) {
    --tcds-site-header-link-color: #fff;
    --tcds-site-header-link-hover-color: #fff;
    --tcds-site-header-utility-link-color: #fff;
    --tcds-site-header-highlight-background: var(--tcds-color-primary);
  }

  background: linear-gradient(0deg, rgb(0 0 0 / 0%) 0%, rgb(0 0 0) 100%);
}

tcds-site-header {
  --tcds-site-header-toggle-color: var(--tcds-color-secondary);
  --tcds-site-header-link-color: var(--tcds-color-secondary);
  --tcds-site-header-link-hover-color: var(--tcds-color-primary);

  display: grid;
  grid-template-columns: var(--tcds-site-header-logo-width) 1fr min-content 2rem;
  grid-template-rows: repeat(2, 1fr);
  grid-template-areas:
    "logo utility utility ."
    "logo primary search .";
  align-items: center;
  background-color: transparent;
  height: var(--tcds-site-header-height);
  position: relative;
  z-index: var(--tcds-z-index-site-header);

  @media (--above-m) {
    --tcds-site-header-menu-gap: 2rem;
  }

  &[open] {
    background: #fff;
  }
  
  &[scrolled] {
    --tcds-site-header-logo-background: none;
    --tcds-site-header-logo-filter: none;
  
    background-color: var(--tcds-color-white);
    box-shadow: var(--tcds-box-shadow-m) var(--tcds-shade-weak);
    position: sticky;
    top: 0;
    animation: tcds-site-header-slide-down 250ms var(--tcds-animation-productive-easing);
  
    @media (--above-m) {
      grid-template-rows: 0fr 1fr;
  
      #utility-menu {
        display: none;
      }
    }

    @keyframes tcds-site-header-slide-down {
      from {
        // Have to use top instead of translate here because it messes with
        // details[open] { position: fixed } below.
        top: calc(var(--tcds-site-header-height) * -1);
      }
    }
  }

  &[data-theme="dark"]:not([scrolled], [open]) {
    @include dark-header;
  }

  @media (prefers-color-scheme: dark) {
    &[data-theme="auto"]:not([scrolled], [open]) {
      @include dark-header;
    }
  }

  @media (--below-m) {
    > details:not([open]) > summary {
      color: var(--tcds-site-header-toggle-color);
    }
  }

  @media (--above-m) {
    > details > summary {
      color: var(--tcds-site-header-toggle-color);
    }
  }

  details {
    summary {
      &::before {
        display: none;
      }
    }
  }
}

[id=site-header-logo] {
  grid-area: logo;
  height: 100%;
  background-image: var(--tcds-site-header-logo-background, url("data:image/svg+xml, %3Csvg%20xmlns=%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20viewBox=%270%200%20386%2090%27%3E%3Cpath%20style=%27fill%3A%20%23da2530%27%20d=%27M261,90c-1.2,0-2.4,0-3.7,0H0V0h386l-67.9,67.2c-6.9,6.9-15.1,12.4-24.1,16.2-8.8,3.8-18.3,6-27.9,6.5h-.2c-1.2,0-3.8,0-5,0Z%27%2F%3E%3C%2Fsvg%3E "));
  background-repeat: no-repeat;

  img {
    max-height: 100%;
    padding: 0 4rem 0 1rem;
    filter: var(--tcds-site-header-logo-filter, saturate(0) contrast(0) brightness(0) invert(1));

    @media (--above-s) {
      padding: 0 6.25rem 0 1rem;
    }
  }
}

details:is(#site-header-nav, #site-header-search) {
  @media (--below-m) {
    grid-row: 1 / -1;

    &[open] {
      position: fixed;
      inset: 0;
      z-index: 2;

      > summary {
        position: absolute;
        top: 1.75rem;
        right: 2rem;
        z-index: 1;
      }
  
      > div {
        position: absolute;
        top: 0;
        right: 0;
        left: 0;
        background-color: var(--tcds-color-white);
      }
    }
  }

  &[open],
  [open] {
    @media (--below-m) {
      --tcds-site-header-menu-toggle-icon: var(--tcds-icon-utility-x);
    }
  
    &::before {
      content: "";
      background: rgb(0 0 0 / 50%);
      position: fixed;
      left: 0;
      right: 0;
      height: calc(100% - 3rem);
      margin-top: 3rem;
    }

    &:is(#site-header-nav)::before {
      @media (--above-m) {
        display: none;
      }
    }
  
    [open]::before {
      @media (--below-m) {
        display: none;
      }
    }
  }

  > summary {
    width: 2rem;
    height: 2rem;
    background-color: currentcolor;
    mask: var(--tcds-site-header-menu-toggle-icon) no-repeat center;
    cursor: pointer;

    @media (--above-m) {
      width: 1rem;
      height: 1rem;
    }
  }
}

[id=site-header-nav] {
  --tcds-site-header-menu-toggle-icon: var(--tcds-icon-utility-hamburger);

  @media (--above-m) {
    display: contents;

    > summary {
      display: none;
    }

    > div {
      display: contents;
    }
  }

  @media (--below-m) {
    grid-column: 3 / 4;

    &:not([open]) {
      margin-left: 1rem;
    }
  }

  > div > nav {
    grid-row: 1 / -1;
    margin-left: auto;

    > ul {
      display: flex;
      list-style: none;
  
      @media (--above-m) {
        gap: var(--tcds-site-header-menu-gap);
      }

      > li {
        > details > summary,
        > a {
          display: flex;
          align-items: center;
          gap: .5ch;
          cursor: pointer;
          color: var(--tcds-site-header-link-color);
          font-family: var(--tcds-font-ui);
          font-size: var(--tcds-font-size-m);
          font-weight: var(--tcds-font-weight-semibold);
          line-height: 1;
          text-decoration: none;
          user-select: none;
        }

        > [open] > summary,
        > details > summary:hover,
        > a:hover {
          color: var(--tcds-site-header-link-hover-color);
        }

        > a > tcds-icon {
          --tcds-icon-size: 1.5em;

          transform: translateY(-9%);
        }
      }
    }
  }
}

[id=site-header-search] {
  --tcds-site-header-menu-toggle-icon: var(--tcds-icon-utility-search);

  grid-area: search;
  margin-left: var(--tcds-site-header-menu-gap);

  @media (--below-m) {
    grid-column: 2 / 3;
    margin-left: auto;
  }
}

#primary-menu {
  grid-area: primary;

  @media (--below-m) {
    padding: 4rem 0;
  }

  > ul {
    @media (--below-m) {
      flex-direction: column;
      align-items: start;
      justify-content: center;
      margin: 0;
    }

    > li {
      @media (--below-m) {
        width: 100%;
      }

      > details > summary,
      > a {
        font-weight: var(--tcds-font-weight-bold);

        @media (--above-m) {
          padding: .5rem 0;
        }

        @media (--below-m) {
          font-size: var(--tcds-font-size-ml);
        }
      }

      > [open] > summary,
      > details > summary:hover,
      > a:hover {
        @media (--above-m) {
          box-shadow: 0 4px 0 var(--tcds-color-red);
        }
      }

      > details {
        @media (--below-m) {
          position: relative;
          z-index: 1;
        }

        &[open] {
          --tcds-site-header-details-icon: var(--tcds-icon-utility-minus);

          &::after {
            @media (--below-m) {
              content: "";
              position: absolute;
              left: 0;
              right: 0;
              top: 3rem;
              height: 2.5rem;
              background-image: linear-gradient(0deg, var(--tcds-color-white) 0%, rgb(246, 246, 246) 100%);
              z-index: -1;
            }
          }
        }

        > summary,
        > div {
          @media (--below-m) {
            width: min(100vw - 2rem, var(--tcds-breakpoint-xs));
            margin: 0 auto;
          }
        }

        > summary {
          @media (--below-m) {
            padding: 1rem 0;

            &::after {
              content: "";
              background-color: var(--tcds-color-primary);
              mask: var(--tcds-site-header-details-icon, var(--tcds-icon-utility-plus)) no-repeat center;
              width: 1em;
              height: 1em;
              margin-left: auto;
            }
          }
        }

        > div {
          @media (--below-m) {
            padding: 2rem 0;
          }
        }
      }
    }

    li:not(:last-of-type) *:not([open]) > summary,
    li:not(:last-of-type) a {
      @media (--below-m) {
        border-bottom: 1px solid var(--tcds-color-gray);
      }
    }
  }
}

#utility-menu {
  grid-area: utility;
  align-self: end;

  @media (--below-m) {
    padding: 3rem 0;
    background: var(--tcds-color-baby-blue);
  }

  > ul {
    @media (--below-m) {
      gap: 1rem 0;
      flex-wrap: wrap;
      width: min(100vw - 2rem, var(--tcds-breakpoint-xs));
      margin: 0 auto;
    }

    > li {
      display: flex;

      @media (--below-m) {
        flex: 1 0 33%;

        &:nth-child(3n+1) {
          text-align: left;
          justify-content: start;
        }

        &:nth-child(3n+2) {
          text-align: center;
          justify-content: center;
        }

        &:nth-child(3n+3) {
          text-align: right;
          justify-content: end;
        }
      }

      > a {
        font-size: var(--tcds-font-size-xs);

        @media (--below-m) {
          font-size: var(--tcds-font-size-m);
        }

        &:not(:hover) {
          color: var(--tcds-site-header-utility-link-color, var(--tcds-site-header-link-color, var(--tcds-color-gray-4)));
        }

        &[data-highlighted] {
          background-color: var(--tcds-site-header-highlight-background, var(--tcds-color-secondary));
          color: var(--tcds-color-white);
          padding: .5rem 1rem;
          border-radius: 1rem;
      
          &:hover {
            background-color: var(--tcds-color-primary);
          }
        }
      }
    }
  }
}

[id="site-header-search"] > div,
[id="primary-menu"] details > div {
  @media (--above-m) {
    position: absolute;
    top: var(--tcds-site-header-height);
    left: 0;
    width: 100%;
    padding: 2rem;
    background: #fff;
  }
}